# Discovery of variables related to vitaminD    

## Discovery of variables related to vitamin D in blood through integrated feature importance analysis on the Korea National Health and Nutrition Examination Survey Data    

(국민건강영양조사 데이터에서의 통합 특성 중요도 분석 기법을 통한 혈중 비타민 D의 관련 인자 발굴)   
> + 기존에 국민건강영양조사 데이터에서 복합표본분석을 이용하여 통계적 분석을 수행한 사전 선행연구들은 비교적 많았다.   
> + 그것들에 비교하여 빅데이터 분석에 더 효과적으로 알려진 머신러닝 기법을 적용하여 분석을 수행한다는 점에서 차별되었다.   
> + 연구를 통해 파악한 비타민 D 부족과 관련된 영향 인자들을 활용하여 보다 정확하고 효과적인 비타민 D 영양 관리 방안을 제시할 수 있을 것으로 기대된다.    
-----------------------------------------------------------------------------------   
## 데이터 설명    
> 국민건강영양조사 데이터는 질병관리청의 주관 하에 1998년 이후 17회에 걸쳐 대한민국 전국민을 대상으로 실시한 [**대규모 보건분야 빅데이터**](https://knhanes.kdca.go.kr/knhanes/sub03/sub03_02_05.do)이다.    
> 본 연구에서 사용한 국민건강영양조사 데이터는 혈중 비타민 D 농도를 측정한 연도인 **2008년**부터 **2014년**까지의 데이터를 통합하여 사용하였다.    
> 데이터는 대상자 53,934명에 대한 건강설문조사, 건강검진조사와 그리고 영양 조사 등에 대한 조사한 항목으로 이루어져있다.    

## 혈중 비타민 D 농도   
혈중 비타민 D는 자외선에 의해 피부에서 생성되거나 식품이나 보충제를 통해 섭취한 비타민 D의 양에 따라 혈액 내에 존재하는 **25(OH)D의 농도**를 의미한다.   
> **세계보건기구에서**는 25(OH)D 농도가 **10 ng/mL 이하인 경우를 결핍**, **20 ng/mL 이하인 경우를 부족**으로 정의하였고    
> 미국 **Institute of Medicine (IOM)**에서는 **12 ng/mL 이하인 경우 결핍**, **20 ng/mL 이상인 경우 충분**으로 보고 있다.   
> 본 연구에서는 IOM의 기준을 사용하여 혈중 비타민 D 농도가 **20 ng/mL 이상이면 충분, 20 ng/mL 미만이면 불충분**으로 구분하였다.    
-----------------------------------------------------------------------------------   
## 분석 방법   
+ **국민건강영양조사 데이터에서 혈중 비타민 D의 관련 인자 발굴을 위해 머신러닝을 이용한 통합 특성 중요도 방법을 제안하고 사용한다.**   
![image](https://user-images.githubusercontent.com/104747868/235339541-e00f04a6-1065-4372-ae5b-849ed261f3ad.png)   

### **머신러닝 모델 학습 및 검증**   
+ 모델   
> RandomForest   
> GradientBoosting   
> (XGBoost)   
> LightGBM   
> CatBoost   
+ 학습 검증   
> 10-fold Cross Validation    

### 개별 및 통합 특성 중요도 산출   
> + 개별 트리 앙상블 머신러닝 모델에 대해서 **특성 중요도(Feature Importance)** 점수로 변수 중요도를 산출했다.
> + 개별 모델의 특성 중요도를 순위화하여 clustermap을 통해 모델 별 변수 순위를 시각화했다. 결과가 유사한 개별 특성 중요도를 평균하여 통합 특성 중요도를 산출했다.  
> + 통합 특성 중요도가 높은 순위의 변수를 혈중 비타민 D 관련 인자로 선택했다.   
-----------------------------------------------------------------------------------   
## 데이터 전처리     
1) **데이터 통합** : 값이 숫자가 아닌 변수와 가중치 변수 삭제하고, 원시자료마다 선지 내용이 다른 경우 통일하였다.   
2) **비해당 및 모름 값 처리** : 범주형 변수에서 비해당 값은 새로운 범주 값을 할당하고 모름 값은 결측값(None)으로 대치했으며, 범주형 변수와 연속형 변수가 혼합되어 있고 나이와 관련 없는 변수일 경우에만 비해당 값을 0 값으로 대치했다.   
3) **결측값 처리** : **범주형 변수**의 경우 결측값은 **최빈값**으로, **연속형 변수**의 경우 결측값은 **중앙값**으로 대치했다.    
4) **혈중 비타민 D에 따른 예측 변수 라벨링** : 혈중 비타민 D 농도가 20 ng/Ml 이상이면 충분, 20 ng/Ml 미만이면 불충분으로 예측변수를 라벨링했다.   

---> 이렇게 전처리를 수행한 결과 39,759명에 대한 343개의 설명변수와 1개의 예측변수의 데이터셋이 생성되었다.   

---------------------------------------------------------------------------     
## 실험 결과   
### 1) Feature Importance 결과 (혈중 비타민 D 관련 상위 10개)       
| Variable 	| Random Forest 	| Gradient Boost 	| LightGBM  	| Cat Boost 	| AVG_rank 	|
|----------	|---------------	|----------------	|-----------	|-----------	|----------	|
| HE_HBsAg 	| 3             	| 9              	| 2         	| 3         	| 4.25     	|
| HE_BUN   	| 1             	| 3              	| 24.5      	| 2         	| 7.625    	|
| HE_crea  	| 8             	| 10             	| 6         	| 9         	| 8.25     	|
| region   	| 12            	| 5              	| 15        	| 5         	| 9.25     	|
| HE_TG    	| 5             	| 16             	| 3         	| 13        	| 9.25     	|
| HE_ht    	| 2             	| 15             	| 7         	| 17        	| 10.25    	|
| HE_ast   	| 4             	| 7              	| 28        	| 4         	| 10.75    	|
| HE_Bplt  	| 6             	| 26             	| 1         	| 15        	| 12       	|
| HE_WBC   	| 7             	| 18             	| 4         	| 25        	| 13.5     	|
| N_VITC   	| 25            	| 11             	| 8         	| 10        	| 13.5     	|    

### 2) 분류 모델 학습 및 평가
**RandomForest, GradientBoosting, XGBoost, LightGBM, CatBoost**의 5종류의 트리 앙상블 모델을 사용하여 학습 및 평가를 진행하고     
**10겹 교차검증으로 ROC-AUC 정확도**를 측정하고 비교하였다.   

+ 트리 앙상블 모델의 ROC-AUC 정확도  
![image](https://user-images.githubusercontent.com/104747868/235304197-2a7837ef-25d6-4101-8cf5-fe332fabd377.png)    

### 3) 개별 특성 중요도 순위 시각화   
RandomForest, GradientBoosting, XGBoost, LightGBM, CatBoost의 개별 특성 중요도를 구하고, 343개 변수에 대해서 순위 결과를 clustermap으로 시각화하였다.   

+ **XGBoost**는 다른 모델들과 다른 순위 결과를 보여주었다. 따라서 우리는 XGBoost를 제외한 나머지 4개의 모델을 사용하여 통합 특성 중요도를 산출하다다.

+ 개별 특성 중요도의 변수 순위에 대한 시각화(ClusterMap)     
![clustermap](https://github.com/SeungW/Discovery-of-variables-related-to-vitaminD/assets/104747868/608ae2cb-59c8-4b37-b712-a07726d07dab)    

### 4) **혈중 비타민 D 관련 상위 10개 변수**   
1위 **B형간염표면항원**  
2위 **혈중요소질소 수치**  
3위 **혈중크레아티닌**   
4위 **16개 시도**   
5위 **중성지방**   
6위 **신장**   
7위 **GOT**   
8위 **혈소판**   
9위 **백혈구**   
10위 **비타민 C**    

+ 상위 10개 변수에 대한 그래프 시각화   
![barplot](https://github.com/SeungW/Discovery-of-variables-related-to-vitaminD/assets/104747868/e2d6b551-d02e-4751-bd20-f06248fb47f8)  

-----------------------------------------------------------

## 결론   
+ 국민건강영양조사 데이터에서 머신러닝을 이용한 통합 특성 중요도 방법을 통해 비타민 D의 중요 인자를 발굴하였다.   
+ 우리가 추출한 중요 인자들 중 다른 연구 결과와 비교하여 우리의 방법이 유의미한 결과임을 확인하였다.    
+ 향후 이루어질 국민건강영양조사 데이터에서 새로운 설문 문항을 통해 다양한 종류의 변수를 머신러닝을 통해 결과를 예측하고 다양한 해석을 할 수 있을 것으로 예상한다.

